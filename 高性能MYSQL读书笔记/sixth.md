# 查询性能优化
> 深刻理解MySql是如何真正的执行查询
* 为何查询速度慢
  - 查询速度快意味着响应的时间变慢，如何把查询的操作分为多个子查询的集合，需要优化每一个子查询的查询速度，降低每个子查询的响应时间与执行次数
  - 执行过程：客户端 服务端  生成执行计划 执行 返回结果给客户端
  - 花费的时间体现：网络传输时间，CPU计算，生成计划，锁等待，内存操作，I/O操作
  - 优化查询的目的就是需要减少与消除不必要或者重复的操作
* 慢查询基础
  - 查询性能低下的原因一般在于访问的数据较多，需要在大量的数据中选择符合条件的数据，需要避免
  - 是否在扫描额外的记录，衡量查询开销的三个指标：
    * 响应时间
      - 服务时间+排队时间 = 响应时间
        * 服务时间指数据库处理查询实际花费的时间
        * 排队时间指由于在等待某些资源而没有真正的执行查询时间，一般为锁等待或者I/O
      - 需要有能力去衡量一个查询大概所需要的时间
    * 扫描的行数与访问类型
      - 关键字Explain使用  
      - 分析：在有无索引时，查询所扫描的行数，可以看出在有索引时的效率提高很多倍；
    * 返回的行数
      - 理想中查询时所扫描的行数与返回的行数一个是相同的，才说这个查询是比较高效的；
      - 上边所述只是理想性的，现实中一般需要扫描许多行才会有一行结果的生成；
* 结构查询重构的方式
  - 一个复杂查询还是若干个简单查询的选择
    * 因为对于MySQL客户端的连接与断开已经是轻量级的操作，MySQL的扫描与网络的带宽在当下时代也是比较令人比较满意的
    * 
  - 切分查询
    * 在实际中一般把大的delete操作拆分为多个子操作，因为大的语句带来的是锁住许多的数据，耗尽系统的资源，阻塞其他的子查询；
    * 尽量把对于空间的压力缓冲到时间的长度上，每次删除固定个大小的数据可以减少系统的吞吐量；